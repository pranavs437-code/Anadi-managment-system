<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Anadi ERP - Central Dashboard</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1e293b">
    <link rel="apple-touch-icon" href="https://anadisevaprakalp.org/wp-content/uploads/elementor/thumbs/anadi-farm-logo-2nd-copy-png-f-pf3gkbrok4it2hn25dsym3ek5sdjquv18uov85lvww.png">
    
    <!-- iOS Specific Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Anadi ERP">
    
    <!-- Tailwind & FontAwesome -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body { 
            background-color: #f1f5f9; 
            -webkit-tap-highlight-color: transparent;
            font-family: 'Segoe UI', sans-serif;
        }
        .card-hover { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .card-hover:active { transform: scale(0.95); }
        @media (hover: hover) {
            .card-hover:hover { transform: translateY(-5px); box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1); }
        }
        
        /* Install Button Animation */
        .install-btn { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .8; } }
        
        /* Loader */
        .loader-spinner {
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-left-color: #f97316;
            border-radius: 50%;
            width: 50px; height: 50px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        /* iOS Modal Animation */
        .slide-up { animation: slideUp 0.3s ease-out forwards; }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- === FULL SCREEN LOADER === -->
    <div id="pageLoader" class="hidden fixed inset-0 z-50 bg-slate-900/90 backdrop-blur-sm flex flex-col items-center justify-center transition-opacity duration-300">
        <div class="loader-spinner mb-4"></div>
        <h2 class="text-white text-xl font-bold tracking-wider animate-pulse">OPENING...</h2>
    </div>

    <!-- Header -->
    <header class="bg-slate-900 text-white p-6 shadow-lg rounded-b-[2rem] relative z-10">
        <div class="flex items-center justify-between max-w-5xl mx-auto">
            <div class="flex items-center gap-4">
                <img src="https://anadisevaprakalp.org/wp-content/uploads/elementor/thumbs/anadi-farm-logo-2nd-copy-png-f-pf3gkbrok4it2hn25dsym3ek5sdjquv18uov85lvww.png" class="w-14 h-14 bg-white rounded-full p-1 shadow-md object-contain">
                <div>
                    <h1 class="text-2xl font-bold tracking-tight">Anadi Seva Prakalp</h1>
                    <p class="text-slate-400 text-sm font-medium uppercase tracking-wider">Integrated ERP System</p>
                </div>
            </div>
            
            <!-- UNIVERSAL INSTALL BUTTON -->
            <!-- Note: 'hidden' class hata di gayi hai JS handle karega -->
            <button id="installAppBtn" style="display: none;" class="bg-gradient-to-r from-orange-500 to-orange-600 text-white px-4 py-2 rounded-lg text-sm font-bold shadow-lg flex items-center gap-2 install-btn">
                <i class="fa-solid fa-download"></i> Install App
            </button>
        </div>
    </header>

    <!-- Main Grid -->
    <main class="flex-1 max-w-5xl mx-auto w-full p-6 -mt-4 relative z-0">
        <p class="text-slate-500 font-bold mb-4 uppercase text-xs tracking-widest pl-1">Select Module</p>
        
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-5">
            <!-- 1. Dairy -->
            <a href="anadiaashram.html" class="module-link card-hover bg-white p-6 rounded-2xl shadow-sm border border-slate-100 flex items-center gap-5 group cursor-pointer decoration-0">
                <div class="w-16 h-16 rounded-2xl bg-orange-50 text-orange-500 flex items-center justify-center text-3xl shadow-sm group-hover:bg-orange-500 group-hover:text-white transition-colors"><i class="fa-solid fa-blender-phone"></i></div>
                <div><h3 class="text-lg font-bold text-slate-800">Dairy Unit</h3><p class="text-xs text-slate-500 mt-1">Milk processing & reports.</p></div>
                <div class="ml-auto text-slate-300"><i class="fa-solid fa-chevron-right"></i></div>
            </a>

            <!-- 2. Billing -->
            <a href="anadibilling.html" class="module-link card-hover bg-white p-6 rounded-2xl shadow-sm border border-slate-100 flex items-center gap-5 group cursor-pointer decoration-0">
                <div class="w-16 h-16 rounded-2xl bg-indigo-50 text-indigo-600 flex items-center justify-center text-3xl shadow-sm group-hover:bg-indigo-600 group-hover:text-white transition-colors"><i class="fa-solid fa-cash-register"></i></div>
                <div><h3 class="text-lg font-bold text-slate-800">Billing POS</h3><p class="text-xs text-slate-500 mt-1">Invoices & Customers.</p></div>
                <div class="ml-auto text-slate-300"><i class="fa-solid fa-chevron-right"></i></div>
            </a>

            <!-- 3. Gaushala -->
            <a href="anadicowshelter.html" class="module-link card-hover bg-white p-6 rounded-2xl shadow-sm border border-slate-100 flex items-center gap-5 group cursor-pointer decoration-0">
                <div class="w-16 h-16 rounded-2xl bg-emerald-50 text-emerald-600 flex items-center justify-center text-3xl shadow-sm group-hover:bg-emerald-600 group-hover:text-white transition-colors"><i class="fa-solid fa-cow"></i></div>
                <div><h3 class="text-lg font-bold text-slate-800">Gaushala</h3><p class="text-xs text-slate-500 mt-1">Cow & Milk records.</p></div>
                <div class="ml-auto text-slate-300"><i class="fa-solid fa-chevron-right"></i></div>
            </a>

            <!-- 4. Expense -->
            <a href="expensemanagment.html" class="module-link card-hover bg-white p-6 rounded-2xl shadow-sm border border-slate-100 flex items-center gap-5 group cursor-pointer decoration-0">
                <div class="w-16 h-16 rounded-2xl bg-red-50 text-red-500 flex items-center justify-center text-3xl shadow-sm group-hover:bg-red-500 group-hover:text-white transition-colors"><i class="fa-solid fa-wallet"></i></div>
                <div><h3 class="text-lg font-bold text-slate-800">Expenses</h3><p class="text-xs text-slate-500 mt-1">Daily Kharcha tracking.</p></div>
                <div class="ml-auto text-slate-300"><i class="fa-solid fa-chevron-right"></i></div>
            </a>

            <!-- 5. Inventory -->
            <a href="inventorystock.html" class="module-link card-hover bg-white p-6 rounded-2xl shadow-sm border border-slate-100 flex items-center gap-5 group cursor-pointer decoration-0">
                <div class="w-16 h-16 rounded-2xl bg-teal-50 text-teal-600 flex items-center justify-center text-3xl shadow-sm group-hover:bg-teal-600 group-hover:text-white transition-colors"><i class="fa-solid fa-boxes-stacked"></i></div>
                <div><h3 class="text-lg font-bold text-slate-800">Inventory</h3><p class="text-xs text-slate-500 mt-1">Stock & Dispatch.</p></div>
                <div class="ml-auto text-slate-300"><i class="fa-solid fa-chevron-right"></i></div>
            </a>
        </div>
    </main>

    <footer class="text-center py-6 text-slate-400 text-xs font-mono">
        Anadi Seva Prakalp Â© 2026
    </footer>

    <!-- === iOS INSTALL INSTRUCTION MODAL === -->
    <div id="iosInstallModal" class="hidden fixed inset-0 z-[100] bg-black/60 backdrop-blur-sm flex items-end justify-center">
        <div class="bg-white w-full max-w-md rounded-t-2xl p-6 slide-up relative">
            <button onclick="document.getElementById('iosInstallModal').classList.add('hidden')" class="absolute top-4 right-4 text-slate-400 hover:text-slate-600">
                <i class="fa-solid fa-xmark text-xl"></i>
            </button>
            <div class="text-center">
                <img src="https://anadisevaprakalp.org/wp-content/uploads/elementor/thumbs/anadi-farm-logo-2nd-copy-png-f-pf3gkbrok4it2hn25dsym3ek5sdjquv18uov85lvww.png" class="w-16 h-16 mx-auto mb-4 rounded-xl shadow-md">
                <h3 class="text-lg font-bold text-slate-800">Install Anadi ERP</h3>
                <p class="text-sm text-slate-500 mt-1 mb-6">Full Screen App Experience</p>
                
                <div class="space-y-4 text-left bg-slate-50 p-4 rounded-xl border border-slate-100">
                    <div class="flex items-center gap-3">
                        <span class="w-6 h-6 bg-slate-200 rounded-full flex items-center justify-center text-xs font-bold text-slate-600">1</span>
                        <p class="text-sm text-slate-600">Tap the <span class="font-bold"><i class="fa-solid fa-arrow-up-from-bracket mx-1"></i> Share</span> button below.</p>
                    </div>
                    <div class="flex items-center gap-3">
                        <span class="w-6 h-6 bg-slate-200 rounded-full flex items-center justify-center text-xs font-bold text-slate-600">2</span>
                        <p class="text-sm text-slate-600">Scroll down & select <span class="font-bold"><i class="fa-regular fa-square-plus mx-1"></i> Add to Home Screen</span>.</p>
                    </div>
                    <div class="flex items-center gap-3">
                        <span class="w-6 h-6 bg-slate-200 rounded-full flex items-center justify-center text-xs font-bold text-slate-600">3</span>
                        <p class="text-sm text-slate-600">Tap <span class="font-bold text-blue-600">Add</span> at top right.</p>
                    </div>
                </div>
                <div class="mt-4 flex justify-center">
                    <i class="fa-solid fa-arrow-down text-2xl text-slate-300 animate-bounce"></i>
                </div>
            </div>
        </div>
    </div>

    <!-- SCRIPTS -->
    <script>
        // --- 1. LOADER LOGIC ---
        document.addEventListener('DOMContentLoaded', () => {
            const loader = document.getElementById('pageLoader');
            document.querySelectorAll('.module-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    loader.classList.remove('hidden');
                });
            });
            window.addEventListener('pageshow', (event) => {
                if (event.persisted) loader.classList.add('hidden');
            });
        });

        // --- 2. INSTALL BUTTON LOGIC (Fixed for iOS) ---
        
        let deferredPrompt; // For Android
        const installBtn = document.getElementById('installAppBtn');
        const iosModal = document.getElementById('iosInstallModal');

        // Robust iOS Detection (Covers iPhone, iPod & iPad)
        const isIos = () => {
            const userAgent = window.navigator.userAgent.toLowerCase();
            return /iphone|ipad|ipod/.test(userAgent) || 
                   (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);
        };

        // Detect if already installed (Standalone Mode)
        const isInStandaloneMode = () => {
            return ('standalone' in window.navigator) && (window.navigator.standalone);
        };

        // --- LOGIC FLOW ---

        // A. Android: Browser automatically fires this
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installBtn.style.display = 'flex'; // Show button for Android
        });

        // B. iOS: Manually check and show button
        // Agar iOS hai aur pehle se Installed nahi hai, to button dikhao
        if (isIos() && !isInStandaloneMode()) {
            installBtn.style.display = 'flex'; // Force show button on iOS
        }

        // C. Universal Click Handler
        installBtn.addEventListener('click', (e) => {
            // Case 1: Android (deferredPrompt exists)
            if (deferredPrompt) {
                installBtn.style.display = 'none';
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => { deferredPrompt = null; });
            } 
            // Case 2: iOS (Show Instruction Modal)
            else if (isIos()) {
                iosModal.classList.remove('hidden');
            }
        });

        // --- 3. SERVICE WORKER ---
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(reg => console.log('SW Registered'))
                    .catch(err => console.log('SW Failed', err));
            });
        }
    </script>
</body>
</html>
